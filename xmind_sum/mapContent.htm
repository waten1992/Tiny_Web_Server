<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- The XHTML header is needed here. Otherwise the panning of our images doesn't work -->
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <title>Map Content</title>
   <link href="Res/styles/shared.css" rel="stylesheet" type="text/css" />
</head>
<body class="overviewMapBody">
<!--START PAGE TOOLS UTILITIES MAP CONTENT IMAGEMAP-->

<div class="overviewDiv">

<table height="100%" align="center" halign="center">
<tr>
<td>

<!-- DETAILED IMAGE MAP -->
  <img id="mapDetailed" 
       src="mapContentImagemap_Details.jpg" 
       usemap="#Details_Imagemap" 
       style="display:show">

<map name="Details_Imagemap">
<area shape="rect" coords="194, 725, 264, 756" href="index.html#Topic2" target="_parent" alt="开始">
<area shape="rect" coords="269, 8, 410, 21" href="index.html#Topic3" target="_parent" alt="./Tiny_web_Server 80">
<area shape="rect" coords="269, 43, 425, 57" href="index.html#Topic4" target="_parent" alt="判断命令行参数 agrc != 2">
<area shape="rect" coords="430, 25, 518, 41" href="index.html#Topic10" target="_parent" alt="若是，continue">
<area shape="rect" coords="430, 44, 543, 60" href="index.html#Topic11" target="_parent" alt="若不是，跳出来报错">
<area shape="rect" coords="269, 63, 432, 77" href="index.html#Topic5" target="_parent" alt="转换port = atoi（argv[1]）">
<area shape="rect" coords="269, 187, 433, 213" href="index.html#Topic6" target="_parent" alt="建立监听描述符,listenfd = Open_listenfd(port) ">
<area shape="rect" coords="438, 175, 502, 195" href="index.html#Topic12" target="_parent" alt="包装函数">
<area shape="rect" coords="508, 118, 808, 151" href="index.html#Topic13" target="_parent" alt="int socket(int domain , int type , int protocol) ---&gt;return nonnegative descriptor if OK , -1 on Error">
<area shape="rect" coords="813, 126, 1006, 142" href="index.html#Topic14" target="_parent" alt="socket(AF_INET,SOCK_STREAM,0)">
<area shape="rect" coords="508, 164, 799, 197" href="index.html#Topic15" target="_parent" alt="int bink(int sockfd ,sturct sockaddr *my_addr , int addrlen) ----&gt;return 0 if OK , -1 on Error">
<area shape="rect" coords="805, 159, 994, 187" href="index.html#Topic16" target="_parent" alt="bind(listenfd, (SA *)&amp;serveraddr, sizeof(serveraddr)">
<area shape="rect" coords="508, 211, 798, 230" href="index.html#Topic17" target="_parent" alt="int listen(int sockfd, int backlog) ,Returns: 0 if OK, −1 on error">
<area shape="rect" coords="803, 205, 942, 221" href="index.html#Topic18" target="_parent" alt="listen(listenfd, LISTENQ)">
<area shape="rect" coords="438, 243, 1070, 263" href="index.html#Topic19" target="_parent" alt="setsockopt(listenfd, SOL_SOCKET, SO_REUSEADDR, (const void *)&amp;optval , sizeof(int)，return 0 if OK , -1 on Error ">
<area shape="rect" coords="1076, 238, 1189, 254" href="index.html#Topic20" target="_parent" alt="出现错误会立即重启">
<area shape="rect" coords="269, 881, 433, 895" href="index.html#Topic7" target="_parent" alt="while(1) 等待连接描述到来">
<area shape="rect" coords="439, 283, 774, 316" href="index.html#Topic21" target="_parent" alt="int accept(int listenfd, struct sockaddr *addr, int *addrlen); Returns: nonnegative connected descriptor if OK, −1 on error">
<area shape="rect" coords="779, 312, 1034, 327" href="index.html#Topic22" target="_parent" alt="Accept(listenfd, (SA *)&amp;clientaddr, &amp;clientlen)">
<area shape="rect" coords="439, 340, 620, 356" href="index.html#Topic23" target="_parent" alt="accept 建立已连接描述符-&gt;confd">
<area shape="rect" coords="439, 899, 585, 919" href="index.html#Topic24" target="_parent" alt="调用处理函数doit(confd)">
<area shape="rect" coords="591, 359, 916, 375" href="index.html#Topic25" target="_parent" alt="Rio_readinitb(&amp;rio , fd ) --- fd连接描述符 ---&gt;rio内部缓冲区">
<area shape="rect" coords="591, 378, 926, 394" href="index.html#Topic26" target="_parent" alt="Rio_readlineb(&amp;rio, buf , MAXLINE) ---rio内部缓冲区 ---&gt;buf ">
<area shape="rect" coords="591, 397, 859, 413" href="index.html#Topic27" target="_parent" alt=" sscanf(buf, &quot;%s %s %s&quot;, method, uri, version);">
<area shape="rect" coords="591, 418, 918, 451" href="index.html#Topic28" target="_parent" alt="if (strcasecmp(method, &quot;GET&quot;))把method提取出来 和 get post比较是否是server能提供的方法">
<area shape="rect" coords="923, 416, 1011, 432" href="index.html#Topic29" target="_parent" alt="若是，continue">
<area shape="rect" coords="923, 440, 1057, 460" href="index.html#Topic30" target="_parent" alt="不是，则调用报错函数">
<area shape="rect" coords="1063, 435, 1560, 451" href="index.html#Topic31" target="_parent" alt="clienterror(fd, method, &quot;501&quot;, &quot;Not Implemented&quot;,&quot;Tiny does not implement this method&quot;);">
<area shape="rect" coords="591, 473, 742, 493" href="index.html#Topic32" target="_parent" alt=" read_requesthdrs(&amp;rio);">
<area shape="rect" coords="747, 468, 864, 484" href="index.html#Topic33" target="_parent" alt="读和解析HTTP的头部">
<area shape="rect" coords="591, 629, 928, 649" href="index.html#Topic34" target="_parent" alt="is_static = parse_uri(uri, filename, cgiargs);  ----&gt;解析URI ">
<area shape="rect" coords="934, 625, 1081, 645" href="index.html#Topic35" target="_parent" alt="if (!strstr(uri, &quot;cgi-bin&quot;))">
<area shape="rect" coords="1087, 545, 1238, 565" href="index.html#Topic36" target="_parent" alt="成立，则是提供静态HTML">
<area shape="rect" coords="1244, 501, 1419, 517" href="index.html#Topic37" target="_parent" alt="strcpy(cgiargs, &quot;&quot;); --&gt;清除CGI">
<area shape="rect" coords="1244, 521, 1467, 536" href="index.html#Topic38" target="_parent" alt="strcpy(filename, &quot;.&quot;);--&gt; begin convert1">
<area shape="rect" coords="1244, 540, 1457, 555" href="index.html#Topic39" target="_parent" alt="strcat(filename, uri);---&gt;end convert1">
<area shape="rect" coords="1244, 564, 1487, 584" href="index.html#Topic40" target="_parent" alt="if (uri[strlen(uri)-1] == '/')---&gt;slashcheck">
<area shape="rect" coords="1492, 559, 1764, 574" href="index.html#Topic41" target="_parent" alt="strcat(filename, &quot;home.html&quot;);--&gt;append default">
<area shape="rect" coords="1244, 587, 1294, 603" href="index.html#Topic42" target="_parent" alt="return 1">
<area shape="rect" coords="1087, 677, 1197, 697" href="index.html#Topic43" target="_parent" alt="否者，是动态内容">
<area shape="rect" coords="1202, 611, 1560, 626" href="index.html#Topic44" target="_parent" alt="ptr = index(uri, '?');----&gt; begin extract 把文件名和参数 用 ？分开">
<area shape="rect" coords="1202, 660, 1255, 680" href="index.html#Topic45" target="_parent" alt="if (ptr)">
<area shape="rect" coords="1261, 648, 1305, 668" href="index.html#Topic46" target="_parent" alt="成立 ">
<area shape="rect" coords="1310, 630, 1448, 658" href="index.html#Topic47" target="_parent" alt="strcpy(cgiargs, ptr+1);     *ptr = '\0';">
<area shape="rect" coords="1261, 681, 1299, 701" href="index.html#Topic48" target="_parent" alt="else">
<area shape="rect" coords="1304, 676, 1515, 691" href="index.html#Topic49" target="_parent" alt="strcpy(cgiargs, &quot;&quot;);  ---&gt;表示没有参数">
<area shape="rect" coords="1202, 704, 1444, 720" href="index.html#Topic50" target="_parent" alt="strcpy(filename, &quot;.&quot;); -----&gt; begin convert2">
<area shape="rect" coords="1202, 723, 1442, 739" href="index.html#Topic51" target="_parent" alt="strcat(filename, uri); ------&gt; end convert2 ">
<area shape="rect" coords="1202, 742, 1258, 758" href="index.html#Topic52" target="_parent" alt="return 0;">
<area shape="rect" coords="591, 796, 909, 816" href="index.html#Topic53" target="_parent" alt="if (stat(filename, &amp;sbuf) &lt; 0)---判断请求的文件是否存在">
<area shape="rect" coords="914, 775, 1002, 791" href="index.html#Topic54" target="_parent" alt="若是，continue">
<area shape="rect" coords="914, 812, 1060, 832" href="index.html#Topic55" target="_parent" alt="若不是，则调用报错函数">
<area shape="rect" coords="1065, 794, 1314, 823" href="index.html#Topic56" target="_parent" alt="clienterror(fd, filename, &quot;404&quot;, &quot;Not found&quot;, &quot;Tiny couldn't find this file&quot;);">
<area shape="rect" coords="591, 1033, 678, 1053" href="index.html#Topic57" target="_parent" alt="若是静态内容">
<area shape="rect" coords="684, 1029, 1188, 1049" href="index.html#Topic58" target="_parent" alt="if (!(S_ISREG(sbuf.st_mode)) || !(S_IRUSR &amp; sbuf.st_mode))---判断是否是普通文件和权限">
<area shape="rect" coords="1193, 1013, 1482, 1033" href="index.html#Topic59" target="_parent" alt="若是，调用serve_static(fd, filename, sbuf.st_size);">
<area shape="rect" coords="1488, 904, 1680, 924" href="index.html#Topic60" target="_parent" alt=" get_filetype(filename, filetype);">
<area shape="rect" coords="1686, 845, 1852, 865" href="index.html#Topic61" target="_parent" alt="if (strstr(filename, &quot;.html&quot;))">
<area shape="rect" coords="1857, 840, 2018, 856" href="index.html#Topic62" target="_parent" alt="strcpy(filetype, &quot;text/html&quot;);">
<area shape="rect" coords="1686, 878, 1866, 898" href="index.html#Topic63" target="_parent" alt="else if (strstr(filename, &quot;.gif&quot;))">
<area shape="rect" coords="1872, 873, 2034, 889" href="index.html#Topic64" target="_parent" alt="strcpy(filetype, &quot;image/gif&quot;);">
<area shape="rect" coords="1686, 924, 1870, 944" href="index.html#Topic65" target="_parent" alt="else if (strstr(filename, &quot;.jpg&quot;))">
<area shape="rect" coords="1875, 906, 2054, 935" href="index.html#Topic66" target="_parent" alt="strcpy(filetype, &quot;image/jpeg&quot;);">
<area shape="rect" coords="1686, 957, 1724, 977" href="index.html#Topic67" target="_parent" alt="else">
<area shape="rect" coords="1729, 952, 1892, 968" href="index.html#Topic68" target="_parent" alt="strcpy(filetype, &quot;text/plain&quot;);">
<area shape="rect" coords="1488, 981, 1693, 996" href="index.html#Topic69" target="_parent" alt="sprintf(buf, &quot;HTTP/1.0 200 OK\r\n&quot;);">
<area shape="rect" coords="1488, 1000, 1781, 1028" href="index.html#Topic70" target="_parent" alt="sprintf(buf, &quot;%sServer: Tiny Web Server\r\n&quot;, buf);">
<area shape="rect" coords="1488, 1032, 1792, 1047" href="index.html#Topic71" target="_parent" alt="sprintf(buf, &quot;%sContent-length: %d\r\n&quot;, buf, filesize);">
<area shape="rect" coords="1488, 1051, 1804, 1066" href="index.html#Topic72" target="_parent" alt="sprintf(buf, &quot;%sContent-type: %s\r\n\r\n&quot;, buf, filetype);">
<area shape="rect" coords="1488, 1070, 1780, 1086" href="index.html#Topic73" target="_parent" alt="Rio_writen(fd, buf, strlen(buf));  fd----&gt;buf 结束输出">
<area shape="rect" coords="1488, 1089, 1807, 1105" href="index.html#Topic74" target="_parent" alt="srcfd = Open(filename, O_RDONLY, 0); -----openfilename">
<area shape="rect" coords="1488, 1108, 1881, 1138" href="index.html#Topic75" target="_parent" alt="srcp = Mmap(0, filesize, PROT_READ, MAP_PRIVATE, srcfd, 0);  mmap -----&gt;在内核空间和用户空间的使用了共同的内存，即是内存共享">
<area shape="rect" coords="1488, 1142, 1673, 1157" href="index.html#Topic76" target="_parent" alt="Close(srcfd);  ----关闭文件描述符">
<area shape="rect" coords="1488, 1161, 1738, 1176" href="index.html#Topic77" target="_parent" alt="Rio_writen(fd, srcp, filesize); ---&gt; fd---&gt;srcp">
<area shape="rect" coords="1488, 1180, 1720, 1196" href="index.html#Topic78" target="_parent" alt="Munmap(srcp, filesize); -----关闭共享内存">
<area shape="rect" coords="1193, 1199, 1564, 1228" href="index.html#Topic79" target="_parent" alt="若不是，调用出错函数 clienterror(fd, filename, &quot;403&quot;, &quot;Forbidden&quot;,   &quot;Tiny couldn't read the file&quot;);">
<area shape="rect" coords="591, 1344, 678, 1365" href="index.html#Topic80" target="_parent" alt="若是动态内容">
<area shape="rect" coords="684, 1340, 1175, 1360" href="index.html#Topic81" target="_parent" alt="if (!(S_ISREG(sbuf.st_mode)) || !(S_IRUSR &amp; sbuf.st_mode))---判断是否是普通文件和权限">
<area shape="rect" coords="1180, 1328, 1464, 1348" href="index.html#Topic82" target="_parent" alt="若是，调用serve_dynamic(fd, filename, cgiargs); ">
<area shape="rect" coords="1470, 1245, 1730, 1273" href="index.html#Topic83" target="_parent" alt="char buf[MAXLINE], *emptylist[] = { NULL };">
<area shape="rect" coords="1470, 1277, 1718, 1318" href="index.html#Topic84" target="_parent" alt=" sprintf(buf, &quot;HTTP/1.0 200 OK\r\n&quot;);  Rio_writen(fd, buf, strlen(buf)); sprintf(buf, &quot;Server: Tiny Web Server\r\n&quot;);">
<area shape="rect" coords="1470, 1322, 1751, 1337" href="index.html#Topic85" target="_parent" alt="Rio_writen(fd, buf, strlen(buf));   ------fd  ---&gt; buf">
<area shape="rect" coords="1470, 1360, 1572, 1380" href="index.html#Topic86" target="_parent" alt="if (Fork() == 0)">
<area shape="rect" coords="1577, 1341, 1871, 1356" href="index.html#Topic87" target="_parent" alt="setenv(&quot;QUERY_STRING&quot;, cgiargs, 1);----获取cgiargs">
<area shape="rect" coords="1577, 1360, 1888, 1375" href="index.html#Topic88" target="_parent" alt="Dup2(fd, STDOUT_FILENO);  -----fd ---&gt;重定向标准输出">
<area shape="rect" coords="1577, 1379, 1901, 1394" href="index.html#Topic89" target="_parent" alt="Execve(filename, emptylist, environ); ----执行CGI运行环境">
<area shape="rect" coords="1470, 1398, 1620, 1413" href="index.html#Topic90" target="_parent" alt="Wait(NULL); ---回收子进程">
<area shape="rect" coords="1180, 1417, 1541, 1445" href="index.html#Topic91" target="_parent" alt="若不是，调用出错函数 clienterror(fd, filename, &quot;403&quot;, &quot;Forbidden&quot;,   &quot;Tiny couldn't read the file&quot;);">
<area shape="rect" coords="439, 1458, 591, 1474" href="index.html#Topic92" target="_parent" alt="Close(connfd);  关闭连接符">
<area shape="rect" coords="194, 1549, 290, 1581" href="index.html#Topic8" target="_parent" alt="数据结构">
<area shape="rect" coords="295, 1553, 353, 1567" href="index.html#Topic9" target="_parent" alt="Rio_t">
</map>

</td>
</tr>
</table>

</div>
<!--END PAGE TOOLS UTILITIES MAP CONTENT IMAGEMAP-->

</body>
</html>
